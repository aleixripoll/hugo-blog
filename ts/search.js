(()=>{var f={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","\u2026":"&hellip;"};function T(l){return f[l]||l}function g(l){return l.replace(/[&<>"]/g,T)}function w(l){return l.replace(/[.*+\-?^${}()|[\]\\]/g,"\\$&")}var m=class l{data;form;input;list;resultTitle;resultTitleTemplate;constructor({form:t,input:e,list:r,resultTitle:o,resultTitleTemplate:n}){this.form=t,this.input=e,this.list=r,this.resultTitle=o,this.resultTitleTemplate=n,this.handleQueryString(),this.bindQueryStringChange(),this.bindSearchForm()}static processMatches(t,e,r=!0,o=140,n=20){e.sort((a,p)=>a.start-p.start);let c=0,s=0,u=0,i=[];for(;c<e.length;){let a=e[c];r&&a.start-n>s?(i.push(`${g(t.substring(s,s+n))} [...] `),i.push(`${g(t.substring(a.start-n,a.start))}`),u+=n*2):(i.push(g(t.substring(s,a.start))),u+=a.start-s);let p=c+1,d=a.end;for(;p<e.length&&e[p].start<=d;)d=Math.max(e[p].end,d),++p;if(i.push(`<mark>${g(t.substring(a.start,d))}</mark>`),u+=d-a.start,c=p,s=d,r&&u>o)break}if(s<t.length){let a=t.length;r&&(a=Math.min(a,s+n)),i.push(`${g(t.substring(s,a))}`),r&&a!=t.length&&i.push(" [...]")}return i.join("")}async searchKeywords(t){let e=await this.getData(),r=[],o=new RegExp(t.filter((n,c,s)=>(s[c]=w(n),n.trim()!=="")).join("|"),"gi");for(let n of e){console.log(n);let c=[],s=[],u=[],i={...n,preview:"",matchCount:0},a=n.content.matchAll(o);for(let h of Array.from(a))u.push({start:h.index,end:h.index+h[0].length});let p=n.title.matchAll(o);for(let h of Array.from(p))c.push({start:h.index,end:h.index+h[0].length});let d=n.description.matchAll(o);for(let h of Array.from(d))s.push({start:h.index,end:h.index+h[0].length});c.length>0&&(i.title=l.processMatches(i.title,c,!1)),s.length>0&&(i.description=l.processMatches(i.description,s)),u.length>0?i.preview=l.processMatches(i.content,u):i.preview=g(i.content.substring(0,140)),i.matchCount=c.length+s.length+u.length,i.matchCount>0&&r.push(i)}return r.sort((n,c)=>c.matchCount-n.matchCount)}async doSearch(t){let e=performance.now(),r=await this.searchKeywords(t);this.clear();for(let n of r)this.list.append(l.render(n));let o=performance.now();this.resultTitle.innerText=this.generateResultTitle(r.length,((o-e)/1e3).toPrecision(1))}generateResultTitle(t,e){return this.resultTitleTemplate.replace("#PAGES_COUNT",t).replace("#TIME_SECONDS",e)}async getData(){if(!this.data){let t=this.form.dataset.json;console.log(t),this.data=await fetch(t).then(r=>r.json());let e=new DOMParser;for(let r of this.data)r.content=e.parseFromString(r.content,"text/html").body.innerText}return this.data}bindSearchForm(){let t="",e=r=>{r.preventDefault();let o=this.input.value.trim();if(l.updateQueryString(o,!0),o==="")return this.clear();t!==o&&(t=o,this.doSearch(o.split(" ")))};this.input.addEventListener("input",e),this.input.addEventListener("compositionend",e)}clear(){this.list.innerHTML="",this.resultTitle.innerText=""}bindQueryStringChange(){window.addEventListener("popstate",t=>{this.handleQueryString()})}handleQueryString(){let e=new URL(window.location.toString()).searchParams.get("keyword");this.input.value=e,e?this.doSearch(e.split(" ")):this.clear()}static updateQueryString(t,e=!1){let r=new URL(window.location.toString());t===""?r.searchParams.delete("keyword"):r.searchParams.set("keyword",t),e?window.history.replaceState("","",r.toString()):window.history.pushState("","",r.toString())}static render(t){return createElement("article",null,createElement("a",{href:t.permalink},createElement("div",{class:"article-details"},createElement("h2",{class:"article-title",dangerouslySetInnerHTML:{__html:t.title}}),createElement("h3",{class:"article-subtitle",dangerouslySetInnerHTML:{__html:t.description}}),createElement("section",{class:"article-preview",dangerouslySetInnerHTML:{__html:t.preview}})),t.image&&createElement("div",{class:"article-image"},createElement("img",{src:t.image,loading:"lazy"}))))}};window.addEventListener("load",()=>{setTimeout(function(){let l=document.querySelector(".search-form"),t=l.querySelector("input"),e=document.querySelector(".search-result--list"),r=document.querySelector(".search-result--title");new m({form:l,input:t,list:e,resultTitle:r,resultTitleTemplate:window.searchResultTitleTemplate})},0)});var v=m;})();
